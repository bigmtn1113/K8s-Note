# 애플리케이션 배포를 위한 고급 설정

<br>

## Pod의 자원 사용량 제한
자원 활용률은 server cluster에서 자원을 얼마나 효율적으로, 빠짐없이 사용하고 있는지를 의미  
K8s는 computing 자원을 container에 할당하기 위한 여러 기능을 제공

### Container와 pod의 자원 사용량 제한 - Limit
자원 할당량을 설정하지 않으면 pod의 container가 node의 물리 자원을 모두 사용할 수 있으므로 자원이 모두 고갈되는 상황 발생 가능성 존재  

#### Pod에 자원 사용량을 명시적으로 설정
`resource-limit-pod.yaml`  
```
apiVersion: v1
kind: pod
metadata:
  name: resource-limit-pod
  lables:
    name: resource-limit-pod
spec:
  containers:
  - name: nginx
    image: nginx:latest
  resources:
    limits:
      memory: "256Mi"
      cpu: "1000m"
```

#### Worker node의 가용 자원 확인
![image](https://github.com/bigmtn1113/K8s-Note/assets/46125158/ea037ee9-d5a1-4e05-8d52-31a85eb7fe6f)

`kubectl describe node` 명령어의 출력 내용 중에서 'Non-terminated Pods' 항목에서 실행 중인 pods의 자원 할당량 확인 가능  
'Allocated resources' 항목에서는 해당 node에서 실행 중인 pods의 자원 할당량을 모두 더한 값이 표시

### Container와 pod의 자원 사용량 제한 - Request
적어도 이 만큼의 자원은 container에게 보장돼야 한다는 것을 의미

Node의 총 자원의 크기보다 더 많은 양의 requests 할당 불가  
K8s의 scheduler는 pod의 requests만큼 여유가 있는 node를 선택해 pod를 생성  
즉, pod를 할당할 때 사용되는 자원할당 기준은 limit가 아닌 requests

※ node에 할당된 pod의 limits 값의 합은 node의 물리 자원의 크기 초과 가능

#### Pod에 자원 사용량을 명시적으로 설정
`resource-limit-with-request-pod.yaml`
```
apiVersion: v1
kind: pod
metadata:
  name: resource-limit-with-request-pod
  lables:
    name: resource-limit-with-request-pod
spec:
  containers:
  - name: nginx
    image: nginx:latest
  resources:
    limits:
      memory: "256Mi"
      cpu: "1000m"
    requests:
      memory: "128Mi"
      cpu: "500m"
```

### CPU 자원 사용량의 제한 원리
